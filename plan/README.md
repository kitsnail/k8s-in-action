# 集群架构与命名

> Beta

![arch](arch.png)

## 命名

### 集群命名

* 格式：`<2位字母城市缩写><1位数字序号>`
  * 数字序号：
    * 总是跳过数字 4
    * 数字 1-9 用于内部生产集群
    * 数字 10-89 用于外部生产集群
    * 数字 90-99 用于内部测试集群
* 示例：
  * bj1: 北京一个内部生产集群
  * sh10: 上海一个外部生产集群
  * gz90: 广州一个内部测试集群

### 节点命名

* 格式：`<集群名称><2位字母节点角色缩写><2-3数字序号>`
  * 数字序号：功能节点使用 2 位数字，计算节点使用 3 位数字
* 控制节点 mn
  * 生产集群至少 3 节点满足 HA 需要，最大 7 节点
  * 示例：`bj1mn01`, `bj1mn02`, `bj1mn03`
* 网络负载均衡节点 ln
  * 生产集群至少 2 节点满足 HA 需要, 可复用管理节点
  * 示例：`bj1ln01`, `bj1ln02`
* 存储节点 sn
  * 生产集群至少 3 节点满足 HA 需要, 推荐配置独立节点 (酌情复用管理节点)
  * 示例：`bj1sn001`, `bj1sn002`, `bj1sn003`
* 数据库节点 dn
  * 生产集群至少 3 节点满足 HA 需要, 推荐配置独立节点 (酌情复用管理节点)
  * 示例：`bj1dn01`, `bj1dn02`, `bj1dn03`
* CPU 计算节点 cn
  * 示例：`bj1cn001`, `bj1cn002`, `bj1cn003`
* GPU 计算节点 gn
  * 示例：`bj1gn001`, `bj1gn002`, `bj1gn003`

### DNS 命名

* 内网：`*.<CLUSTER>i.example.com`, 例如 `*.bj1i.example.com`
* 外网：`*.<CLUSTER>.example.com`, 例如 `*.bj1.example.com`

> * example.com 为示例域名，根据实际情况进行替换
> * i 是 internal 的缩写，表示内部服务

## 网络

- 所有节点至少 10Gb 以太内网互联
- 存储节点额外提供至少 10Gb 以太网互联进行数据复制，配置此网络可以极大提供存储性能
- 提供网络负载均衡节点至少 1Gb 接入互联网，如果不面向外部提供服务此网络可选。

> 可以根据具体业务和用户需求调整网络配置。

## 软件

- OS: ubuntu 22.04
- K8S: [k3s](https://k3s.io/) v1.31
- Ceph: [ceph](https://docs.ceph.com/en/latest/releases/) v19.2

> 更多需求可以参考 [k3s requirements](https://docs.k3s.io/zh/installation/requirements)